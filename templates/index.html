<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RX7 DASHBOARD</title>
    <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css" rel="stylesheet"> -->
    <!-- <script>
        import {zingchart, ZC} from './zingchart/es6.js';
        // Modules must be imported EXPLICITLY when using es6 version
        import './zingchart/modules-es6/zingchart-pareto.min.js';
    </script> -->
    <script src="static/zingchart.min.js"></script> 
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"> -->
</head>
<body style="background:black; color:white">
<div>
    <div style="width: 50%; margin: 20; float:left;" id="Speedchart"></div>
    <!-- <div id="Rpmchart"></div> -->
    <div style="float:left; margin:20; text-align:left;" id="RawData"> </div>
</div>
    
<script>
    var data = null
    let speedConfig = {
        theme: "dark", "background-color":'black',
        type: "gauge",
        globals: {fontSize: 25},
        scale: {},'scale-2': {'size-factor':1},
        plot: {
          size: '100%',
          valueBox: {
          placement: 'center',
          text: '%v', //default
          "font-color": "white",
          fontSize: 35,
          rules: []
          }
        },
        "scale-r-2": {
          aperture: 275,
          values: "0:180:20",
          // markers: [{ //used for red portion of rpm
          //   type: "area",
          //   range: [160,180],
          //   'offset-start':0.82,
          //   'offset-end':0.1,
          //   'background-color': "red",
          //   alpha:0.7,
          // }],
          center: {
          alpha: 1,
          backgroundColor: 'black',
          borderColor: 'white',
          borderWidth: 2,
          size: 40,
          type: 'circle',
          x: '50%',
          visible: true,
          y: '50%'
          },
          tick: {
          alpha: 1,
          lineColor: 'white',
          lineStyle: 'solid',
          lineWidth: 3,
          placement: 'inner',
          size: 35,
          visible: true,
          rules: [{
            rule: '%i == 80',
            lineColor: "red"
          }]
          },
          minorTicks: 3,
          minorTick: {
          alpha: 1,
          lineColor: 'white',
          lineStyle: 'solid',
          lineWidth: 2,
          placement: 'inner',
          size: 20,
          visible: true
          },
          minorGuide: {visible: false},
          item: {
          'font-size':30,
          'padding': 15,
          offsetR: -145,
          rules: [{ //fiddle with this for placement of gauge nums
            rule: 'true',
            offsetX: -10,
            offsetY: -6
          // },
          // {
          //     rule: '%i == 80',
          //     offsetX: -20,
          //     offsetY: -6
          // },
          // {
              // rule: '%i == 0',
              // offsetX: -15,
              // offsetY: 17
          }]
          },
          // labels: ['0','20', '40', '60', '80', '100', '120', '140', '160', '180'],
          ring: {
          size: 15,
          // rules: [{ // uncomment for red marker btw 160 and 180
          //   rule: '%v >= 160 && %v < 180',
          //   backgroundColor: '#E53935',
          //   }]
          },
        },
        'scale-r':{ //gauge backlight hack
          aperture:360,values: "0:360:360",
          guide:{
            items:[{
              "fill-type":"radial",
              backgroundColor1:"#000050", //COLOR SCHEME
              backgroundColor2:"black"
            }],
          },
          center: {visible:false},ring: {visible:false},item: {alpha: 0},tick: {alpha: 0}
        },
        series: [
          {
            values:[0],
            backgroundColor: 'red',
            visible: false
          },
          {
            values: [0], // starting value
            backgroundColor: 'red',
            indicator: [-3, -3, -1, -100,-.3],
            scales:"scale-2, scale-r-2",
            animation: {
            effect: 2, 
            method: 5,
            sequence: 0,  
            speed: 500
            },
          }]
    };

    // var rpmConfig = {
    //     theme: "dark",
    //     type: "gauge",
    //     globals: {
    //         fontSize: 25
    //     },
    //     plotarea: {
    //         marginTop: 80
    //     },
    //     plot: {
    //         size: '100%',
    //         valueBox: {
    //         placement: 'center',
    //         text: '%v', //default
    //         "font-color": "white",
    //         fontSize: 35,
    //         rules: []
    //         }
    //     },
    //     tooltip: {
    //         borderRadius: 5
    //     },

    //     scaleR: {
    //         aperture: 275,
    //         values: "0:9",
    //         // markers: [{ //used for red portion of rpm
    //         //   type: "area",
    //         //   range: [160,180],
    //         //   'offset-start':0.82,
    //         //   'offset-end':0.1,
    //         //   'background-color': "red",
    //         //   alpha:0.7,
    //         // }],
    //         center: {
    //         alpha: .75,
    //         backgroundColor: 'black',
    //         borderColor: 'white',
    //         borderWidth: 2,
    //         size: 40,
    //         type: 'circle',
    //         x: '50%',
    //         visible: true,
    //         y: '50%'
    //         },
    //         tick: {
    //         alpha: 1,
    //         lineColor: 'white',
    //         lineStyle: 'solid',
    //         lineWidth: 3,
    //         placement: 'inner',
    //         size: 35,
    //         visible: true,
    //         rules: [{
    //             rule: '%i == 80',
    //             lineColor: "red"
    //         }]
    //         },
    //         minorTicks: 3,
    //         minorTick: {
    //         alpha: 1,
    //         lineColor: 'white',
    //         lineStyle: 'solid',
    //         lineWidth: 2,
    //         placement: 'inner',
    //         size: 20,
    //         visible: true
    //         },
    //         minorGuide: {visible: false},
    //         item: {
    //         'font-size':40,
    //         'padding': 10,
    //         offsetR: -130,
    //         rules: [{
    //             // rule: '%i >= 0',
    //             // offsetX: -10,
    //             // offsetY: -6
    //         // },
    //         // {
    //         //     rule: '%i >= 20 && %i < 80',
    //         //     offsetX: -14,
    //         //     offsetY: -4
    //         // },
    //         // {
    //         //     rule: '%i < 20',
    //         //     offsetX: -15,
    //         //     offsetY: 17
    //         }]
    //         },
    //         labels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],
    //         ring: {
    //         size: 15,
    //         rules: [{
    //             rule: '%v >= 8 && %v < 9',
    //             backgroundColor: '#E53935',
    //             }]
    //         },

    //     },
    //     series: [{
    //         values: [0], // starting value
    //         backgroundColor: 'red',
    //         indicator: [-3, -3, -1, -100,-.3],
    //         animation: {
    //         effect: 2, 
    //         method: 0,
    //         sequence: 0,
    //         speed: 500
    //         },
    //     }]
    //     };

    zingchart.render({
        id: 'Speedchart',
        data: speedConfig,
        height: 720,
        width: 600
    });

    // zingchart.render({
    //     id: 'RpmChart',
    //     data: rpmConfig,
    //     height: 600,
    //     width: 600
    // });
        
    var source = new EventSource('/data');
    source.onmessage = function (event) {
        data = JSON.parse(event.data);
        var out = document.getElementById('RawData');
        out.innerHTML = "speed: " + data.speed + '<br>'
        + 'ignition: ' + data.ignition + '<br>'
        + 'currently charging: ' + data.charging + '<br>'
        + "cell volt avg:  " + data.avgcellvolts + '<br>'
        + 'cell volt max deviation: ' + data.cellvoltdevmax + '<br>'
        + 'batt temp avg: ' + data.avgbatttemps + '<br>'
        + 'batt temp max deviation: ' + data.batttempdevmax + '<br>'
        + 'pi temp: ' + data.pitemp + ' &deg;C <br>'
        + 'pi CPU: ' + parseFloat(data.piload) + '%'
        + '<br>';
        // update speed gauge
        zingchart.exec('Speedchart', 'setseriesvalues', {
            plotindex:1,
            values: [parseInt(data.speed)]
        });
        // update rpm gauge
        // zingchart.exec('Rpmchart', 'setseriesvalues', {
        //     plotindex:0,
        //     values: [parseInt(data.rpm)]
        // });
        
    }
</script>

</body>
</html> 